{"_path":"/blog/creer-une-collection-ansible-redis-avec-molecule","_dir":"blog","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Créer une collection Ansible Redis avec Molecule","description":"Découvrez comment utiliser Ansible et Molecule pour créer rapidement et efficacement une collection personnalisée pour Redis.","img":"/post-thumbnail-01.jpg","tags":["Infrastructure-as-Code","Ansible","Dev"],"createdAt":"2021-04-13T00:00:00.000Z","updatedAt":null,"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Si vous êtes à la recherche d'un moyen pour automatiser l'installation et la configuration d'un cluster Redis, Ansible est un excellent choix. Dans cet article, nous allons voir comment créer une nouvelle "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"collection Ansible"}]},{"type":"text","value":" pour l'installation et la configuration d'un "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"cluster Redis"}]},{"type":"text","value":" en utilisant "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ansible Galaxy"}]},{"type":"text","value":" et "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Molecule"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ce dont vous avez besoin\nAvant de commencer, vous devez installer Ansible Galaxy et Molecule. Si vous ne les avez pas encore installés, voici comment procéder :"}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"# Installation d'Ansible Galaxy\n$ sudo apt-get install ansible-galaxy\n\n# Installation de Molecule\n$ pip install molecule\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# Installation d'Ansible Galaxy\n$ sudo apt-get install ansible-galaxy\n\n# Installation de Molecule\n$ pip install molecule\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"étape-1-création-de-la-collection-ansible"},"children":[{"type":"text","value":"Étape 1 : Création de la collection Ansible"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La première étape consiste à créer une nouvelle collection Ansible à l'aide de la commande ansible-galaxy collection init."}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"$ ansible-galaxy collection init my_redis_cluster\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ ansible-galaxy collection init my_redis_cluster\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La commande créera une nouvelle collection nommée "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"my_redis_cluster"}]},{"type":"text","value":" avec un ensemble de fichiers et de dossiers. Nous allons travailler principalement dans les dossiers roles et molecule de la collection."}]},{"type":"element","tag":"h2","props":{"id":"étape-2-création-du-rôle-ansible"},"children":[{"type":"text","value":"Étape 2 : Création du rôle Ansible"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La prochaine étape consiste à créer un nouveau rôle à l'intérieur de la collection. Nous allons utiliser Molecule pour créer la structure de notre rôle."}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"$ cd my_redis_cluster/roles\n$ molecule init role -r redis_cluster\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ cd my_redis_cluster/roles\n$ molecule init role -r redis_cluster\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La commande ci-dessus créera un nouveau rôle nommé "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"redis_cluster"}]},{"type":"text","value":" à l'intérieur de notre collection. La commande créera également une structure de dossier initiale pour le rôle."}]},{"type":"element","tag":"h2","props":{"id":"étape-3-écriture-du-code"},"children":[{"type":"text","value":"Étape 3 : Écriture du code"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nous sommes maintenant prêts à écrire le code pour notre rôle. Ouvrez le fichier "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"tasks/main.yml"}]},{"type":"text","value":" dans le dossier "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"roles/redis_cluster"}]},{"type":"text","value":" et ajoutez la tâche suivante pour installer Redis :"}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"- name: Install Redis\n  apt:\n    name: redis\n    state: present\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"- name: Install Redis\n  apt:\n    name: redis\n    state: present\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ensuite, ouvrez le fichier "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"defaults/main.yml"}]},{"type":"text","value":" et ajoutez les variables suivantes pour configurer Redis :"}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"redis_port: 6379\nredis_bind: 127.0.0.1\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"redis_port: 6379\nredis_bind: 127.0.0.1\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dans le fichier "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"templates/redis.conf.j2"}]},{"type":"text","value":", ajoutez la configuration suivante :"}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"port {{ redis_port }}\nbind {{ redis_bind }}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"port {{ redis_port }}\nbind {{ redis_bind }}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Enfin, modifiez le fichier "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"tasks/main.yml"}]},{"type":"text","value":" pour appliquer la configuration à Redis :"}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"- name: Configure Redis\n  template:\n    src: redis.conf.j2\n    dest: /etc/redis/redis.conf\n  notify: Restart Redis\n\n- name: Restart Redis\n  service:\n    name: redis\n    state: restarted\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"- name: Configure Redis\n  template:\n    src: redis.conf.j2\n    dest: /etc/redis/redis.conf\n  notify: Restart Redis\n\n- name: Restart Redis\n  service:\n    name: redis\n    state: restarted\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"étape-4-tests-avec-molecule"},"children":[{"type":"text","value":"Étape 4 : Tests avec Molecule"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Il est maintenant temps de tester notre rôle avec Molecule. Nous allons utiliser la commande molecule test pour lancer les tests d'"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"idempotence"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"$ cd ../molecule/default\n$ molecule test\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ cd ../molecule/default\n$ molecule test\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La commande ci-dessus va créer une machine virtuelle, appliquer notre rôle Ansible et vérifier que tout fonctionne correctement. Si tout est OK, vous devriez voir un message comme celui-ci :"}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"    PLAY RECAP *********************************************************************\n    instance                   : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"    PLAY RECAP *********************************************************************\n    instance                   : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dans cet article, nous avons vu comment créer une nouvelle collection Ansible pour l'installation et la configuration d'un cluster Redis en utilisant Ansible Galaxy et Molecule. Nous avons utilisé Ansible pour installer Redis et configuré les variables à l'aide de fichiers de configuration Jinja2. Nous avons également utilisé Molecule pour tester notre rôle Ansible et vérifier qu'il fonctionne correctement. Vous pouvez maintenant utiliser cette collection Ansible pour automatiser l'installation et la configuration de votre propre cluster Redis."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"étape-1-création-de-la-collection-ansible","depth":2,"text":"Étape 1 : Création de la collection Ansible"},{"id":"étape-2-création-du-rôle-ansible","depth":2,"text":"Étape 2 : Création du rôle Ansible"},{"id":"étape-3-écriture-du-code","depth":2,"text":"Étape 3 : Écriture du code"},{"id":"étape-4-tests-avec-molecule","depth":2,"text":"Étape 4 : Tests avec Molecule"},{"id":"conclusion","depth":2,"text":"Conclusion"}]}},"_type":"markdown","_id":"content:blog:creer-une-collection-ansible-redis-avec-molecule.md","_source":"content","_file":"blog/creer-une-collection-ansible-redis-avec-molecule.md","_extension":"md"}